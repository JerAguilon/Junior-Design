{% extends 'dashboard.html' %}

{% block page_name %}
    {{page_name}}
{% endblock page_name %}

{% block scripts %}
<script>
    $(document).on('click', '.project-card:not(".add-project-card")', function() {
        window.location.replace('/projects/' + $(this).attr('data-name'));
        console.log($(this).attr('data-name'));
    });

    var addProjectForm = `
        <form action="#" class="modal-form">
            <div class="mdl-textfield mdl-js-textfield">
                <input class="mdl-textfield__input" type="textarea" id="project" />
                <label class="mdl-textfield__label" for="project">Project</label>
            </div>
        </form>`;

    var newProjectFormat = `
        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid mdl-grid mdl-cell--6-col project-card" data-name="{0}">
            <div class="project-circle">
                <div class="project-circle-text">
                      {1}
                </div>
            </div>

            <div class="mdl-cell project-card-description" >
                <div class="mdl-cell mdl-cell--12-col project-card-header">
                    {2}
                    <hr>
                </div>
                <div class="mdl-cell mdl-cell--12-col">
                    <div class="mdl-cell--12-col">
                        <b>Current Goal: </b>None
                    </div>
                    <div class="mdl-cell--12-col">
                        <b>Last Updated: </b> {3}
                    </div>
                </div>

            </div>
        </div>`;

    $(document).on('keyup keypress', 'form input[type="text"]', function(e) {
      if(e.which == 13) {
        e.preventDefault();
        return false;
      }
    });
    $('.add-project-card').click(function() {
        showDialog({
                text: addProjectForm,
                negative: {
                    title: 'Cancel'
                },
                positive: {
                    title: 'Add Project',
                    onClick: function (e) {
                        var project = $("#project").val();
                        if (project) {
                            var currentTime = moment();
                            var newProjectHtml =  newProjectFormat.format(
                                    project,
                                    project.substring(0, 1),
                                    project,
                                    currentTime.calendar());
                            $('.project-list>div:eq(0)').after(newProjectHtml);
                            //element.insertAdjacentHTML('beforeend', newGoalHtml)
                            $.ajax({
                                url: '/new_project',
                                data: {'project_name': project},
                                type: 'POST',
                                success: function(response){
                                    console.log(response);
                                },
                                error: function(error){
                                    console.log(error);
                                }
                            });
                        } else {
                            alert("Invalid project.");
                        }
                    }
                }
        });
    });

</script>
{% endblock scripts %}

{% block content %}
    <form method="POST">
        <div class='mdl-grid project-list'>
            <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid mdl-grid mdl-cell--6-col project-card add-project-card">
                <div class="project-circle project-add-circle">
                    <div class="project-circle-text">
                        +
                    </div>
                </div>
                <div class="mdl-cell project-card-description">
                    <div class="mdl-cell mdl-cell--10-col project-card-header">
                        Add Project
                        <hr>
                    </div>
                </div>
            </div>
            <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid mdl-grid mdl-cell--6-col project-card" data-name="Personal Journal of Short Stories">
                <div class="project-circle">
                    <div class="project-circle-text">
                        P
                    </div>
                </div>

                <div class="mdl-cell project-card-description" >
                    <div class="mdl-cell mdl-cell--12-col project-card-header">
                        Personal Journal of Short Stories
                        <hr>
                    </div>
                    <div class="mdl-cell mdl-cell--12-col">
                        <div class="mdl-cell--12-col">
                            <b>Current Goal: </b>Complete Under and Above short story
                        </div>
                        <div class="mdl-cell--12-col">
                            <b>Last Updated: </b> Nov. 5 at 4:14pm
                        </div>
                    </div>

                </div>
            </div>

            <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid mdl-grid mdl-cell--6-col project-card" data-name="AE Research">
                <div class="project-circle">
                    <div class="project-circle-text">
                        A
                    </div>
                </div>

                <div class="mdl-cell project-card-description">
                    <div class="mdl-cell mdl-cell--12-col project-card-header">
                        AE Research
                        <hr>
                    </div>
                    <div class="mdl-cell mdl-cell--12-col">
                        <div class="mdl-cell--12-col">
                            <b>Current Goal: </b>Complete executive summary v. 1.1
                        </div>
                        <div class="mdl-cell--12-col">
                            <b>Last Updated: </b> Nov. 4 at 8:19pm
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </form>
{% endblock content %}